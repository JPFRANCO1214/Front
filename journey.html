<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Network Management</title>
  <link rel="stylesheet" href="css/journey.css">
  <style type="text/css">
    #mynetwork {
      width: 100%;
      height: 100vh;
      margin-top: -125px;
      margin-left: -375px;
    }
  </style>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>

</head>
<body>
  <header>
    <button class="luz"></button>
    <section>
      <label class="label">
        <input id="home" name="page" type="radio" checked="" onclick="redirigir()"/>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21 20" height="20" width="21" >
          <image href="css/img/hogar.svg" height="25" width="21" />
        </svg>
      </label>
      <label class="label">
        <input id="cart" name="page" type="radio"/>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21 20" height="20" width="21">
          <image href="css/img/ajustes.svg" height="25" width="21" />
        </svg>
      </label>
      <label class="label">
        <input id="notifications" name="page" type="radio"/>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21 20" height="20" width="21">
          <image href="css/img/globo.svg" height="25" width="21" />
        </svg>      
      </label>
    </section>
    <button class="button" onclick="showQR()">
      <img class="bell" src="css/img/campana.svg" alt="Campana">
    </button>    
    
    <div class="qr-container" id="qr-container">
      <img class="qr-image" src="css/img/VQ9-a2_qrcode.png" alt="Código QR">
    </div>
  </header>

  <main>
    <h1>Network Active Search</h1>
    <div id="mynetwork"></div>
  </main>

  <script>
    // Variable para almacenar la información de la red
    var networkData = []; // Inicialmente vacío

    // Obtener datos de la red desde el servidor
    fetch('http://localhost:5000/api/python')
      .then(response => response.json())
      .then(data => {
        networkData = data; // Actualizar datos de la red
        createNetworkTopology(networkData); // Crear la topología de red
      })
      .catch(error => {
        console.error('Hubo un error:', error);
      });

    // Función para crear la topología de red con Vis.js
    function createNetworkTopology(data) {
      var nodes = new vis.DataSet();
      var edges = new vis.DataSet();

      // Agregar nodos y conexiones al conjunto de datos
      data.forEach(function(device) {
        nodes.add({
          id: device.ip,
          label: device.deviceType + '\n' + device.ip // Agregar la IP al label del nodo
        });

        

        device.connections.forEach(function(connection) {
          // Agregar conexión entre dispositivos
          edges.add({
            from: connection.From_IP,
            to: connection.To_IP,
            label: connection.Connected_from_Interface + ' -> ' + connection.Connected_to_Interface + '\n' + connection.From_IP + ' -> ' + connection.To_IP // Mostrar información en la conexión
          });
        });
      });

      // Crear una nueva red Vis.js
      var container = document.getElementById("mynetwork");
      var data = {
        nodes: nodes,
        edges: edges
      };
      var options = {
        edges: {
          color: {
            color: '#9148ff', 
            highlight: '#00FF0D' 
          },
          width: 2, 
          selectionWidth: 2, 
          smooth: {
            type: 'dynamic', 
            forceDirection: 'horizontal' 
          },
          dashes: true, 
          chosen: true 
        },
        interaction: {
          hover: true 
        }
      };
      var network = new vis.Network(container, data, options);
    }
  </script>
</body>
</html>
